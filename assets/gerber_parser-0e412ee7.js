/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Rt=Symbol("Comlink.proxy"),_n=Symbol("Comlink.endpoint"),On=Symbol("Comlink.releaseProxy"),et=Symbol("Comlink.finalizer"),Ne=Symbol("Comlink.thrown"),Pt=e=>typeof e=="object"&&e!==null||typeof e=="function",Tn={canHandle:e=>Pt(e)&&e[Rt],serialize(e){const{port1:t,port2:n}=new MessageChannel;return ft(e,t),[n,[n]]},deserialize(e){return e.start(),Nn(e)}},Mn={canHandle:e=>Pt(e)&&Ne in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},Ct=new Map([["proxy",Tn],["throw",Mn]]);function kn(e,t){for(const n of e)if(t===n||n==="*"||n instanceof RegExp&&n.test(t))return!0;return!1}function ft(e,t=globalThis,n=["*"]){t.addEventListener("message",function r(o){if(!o||!o.data)return;if(!kn(n,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:s,type:i,path:c}=Object.assign({path:[]},o.data),l=(o.data.argumentList||[]).map(re);let f;try{const h=c.slice(0,-1).reduce((g,x)=>g[x],e),d=c.reduce((g,x)=>g[x],e);switch(i){case"GET":f=d;break;case"SET":h[c.slice(-1)[0]]=re(o.data.value),f=!0;break;case"APPLY":f=d.apply(h,l);break;case"CONSTRUCT":{const g=new d(...l);f=$n(g)}break;case"ENDPOINT":{const{port1:g,port2:x}=new MessageChannel;ft(e,x),f=An(g,[g])}break;case"RELEASE":f=void 0;break;default:return}}catch(h){f={value:h,[Ne]:0}}Promise.resolve(f).catch(h=>({value:h,[Ne]:0})).then(h=>{const[d,g]=Ce(h);t.postMessage(Object.assign(Object.assign({},d),{id:s}),g),i==="RELEASE"&&(t.removeEventListener("message",r),At(t),et in e&&typeof e[et]=="function"&&e[et]())}).catch(h=>{const[d,g]=Ce({value:new TypeError("Unserializable return value"),[Ne]:0});t.postMessage(Object.assign(Object.assign({},d),{id:s}),g)})}),t.start&&t.start()}function Sn(e){return e.constructor.name==="MessagePort"}function At(e){Sn(e)&&e.close()}function Nn(e,t){return nt(e,[],t)}function ke(e){if(e)throw new Error("Proxy has been released and is not useable")}function $t(e){return fe(e,{type:"RELEASE"}).then(()=>{At(e)})}const Re=new WeakMap,Pe="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(Re.get(e)||0)-1;Re.set(e,t),t===0&&$t(e)});function Rn(e,t){const n=(Re.get(t)||0)+1;Re.set(t,n),Pe&&Pe.register(e,t,e)}function Pn(e){Pe&&Pe.unregister(e)}function nt(e,t=[],n=function(){}){let r=!1;const o=new Proxy(n,{get(s,i){if(ke(r),i===On)return()=>{Pn(o),$t(e),r=!0};if(i==="then"){if(t.length===0)return{then:()=>o};const c=fe(e,{type:"GET",path:t.map(l=>l.toString())}).then(re);return c.then.bind(c)}return nt(e,[...t,i])},set(s,i,c){ke(r);const[l,f]=Ce(c);return fe(e,{type:"SET",path:[...t,i].map(h=>h.toString()),value:l},f).then(re)},apply(s,i,c){ke(r);const l=t[t.length-1];if(l===_n)return fe(e,{type:"ENDPOINT"}).then(re);if(l==="bind")return nt(e,t.slice(0,-1));const[f,h]=_t(c);return fe(e,{type:"APPLY",path:t.map(d=>d.toString()),argumentList:f},h).then(re)},construct(s,i){ke(r);const[c,l]=_t(i);return fe(e,{type:"CONSTRUCT",path:t.map(f=>f.toString()),argumentList:c},l).then(re)}});return Rn(o,e),o}function Cn(e){return Array.prototype.concat.apply([],e)}function _t(e){const t=e.map(Ce);return[t.map(n=>n[0]),Cn(t.map(n=>n[1]))]}const It=new WeakMap;function An(e,t){return It.set(e,t),e}function $n(e){return Object.assign(e,{[Rt]:!0})}function Ce(e){for(const[t,n]of Ct)if(n.canHandle(e)){const[r,o]=n.serialize(e);return[{type:"HANDLER",name:t,value:r},o]}return[{type:"RAW",value:e},It.get(e)||[]]}function re(e){switch(e.type){case"HANDLER":return Ct.get(e.name).deserialize(e.value);case"RAW":return e.value}}function fe(e,t,n){return new Promise(r=>{const o=In();e.addEventListener("message",function s(i){!i.data||!i.data.id||i.data.id!==o||(e.removeEventListener("message",s),r(i.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:o},t),n)})}function In(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var jn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},rt={},zn={get exports(){return rt},set exports(e){rt=e}};(function(e){(function(t,n){e.exports?e.exports=n():t.moo=n()})(jn,function(){var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=typeof new RegExp().sticky=="boolean";function o(u){return u&&n.call(u)==="[object RegExp]"}function s(u){return u&&typeof u=="object"&&!o(u)&&!Array.isArray(u)}function i(u){return u.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function c(u){var p=new RegExp("|"+u);return p.exec("").length-1}function l(u){return"("+u+")"}function f(u){if(!u.length)return"(?!)";var p=u.map(function(y){return"(?:"+y+")"}).join("|");return"(?:"+p+")"}function h(u){if(typeof u=="string")return"(?:"+i(u)+")";if(o(u)){if(u.ignoreCase)throw new Error("RegExp /i flag not allowed");if(u.global)throw new Error("RegExp /g flag is implied");if(u.sticky)throw new Error("RegExp /y flag is implied");if(u.multiline)throw new Error("RegExp /m flag is implied");return u.source}else throw new Error("Not a pattern: "+u)}function d(u,p){return u.length>p?u:Array(p-u.length+1).join(" ")+u}function g(u,p){for(var y=u.length,m=0;;){var w=u.lastIndexOf(`
`,y-1);if(w===-1||(m++,y=w,m===p)||y===0)break}var v=m<p?0:y+1;return u.substring(v).split(`
`)}function x(u){for(var p=Object.getOwnPropertyNames(u),y=[],m=0;m<p.length;m++){var w=p[m],v=u[w],_=[].concat(v);if(w==="include"){for(var R=0;R<_.length;R++)y.push({include:_[R]});continue}var S=[];_.forEach(function(b){s(b)?(S.length&&y.push(M(w,S)),y.push(M(w,b)),S=[]):S.push(b)}),S.length&&y.push(M(w,S))}return y}function E(u){for(var p=[],y=0;y<u.length;y++){var m=u[y];if(m.include){for(var w=[].concat(m.include),v=0;v<w.length;v++)p.push({include:w[v]});continue}if(!m.type)throw new Error("Rule has no type: "+JSON.stringify(m));p.push(M(m.type,m))}return p}function M(u,p){if(s(p)||(p={match:p}),p.include)throw new Error("Matching rules cannot also include states");var y={defaultType:u,lineBreaks:!!p.error||!!p.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var m in p)t.call(p,m)&&(y[m]=p[m]);if(typeof y.type=="string"&&u!==y.type)throw new Error("Type transform cannot be a string (type '"+y.type+"' for token '"+u+"')");var w=y.match;return y.match=Array.isArray(w)?w:w?[w]:[],y.match.sort(function(v,_){return o(v)&&o(_)?0:o(_)?-1:o(v)?1:_.length-v.length}),y}function j(u){return Array.isArray(u)?E(u):x(u)}var z=M("error",{lineBreaks:!0,shouldThrow:!0});function P(u,p){for(var y=null,m=Object.create(null),w=!0,v=null,_=[],R=[],S=0;S<u.length;S++)u[S].fallback&&(w=!1);for(var S=0;S<u.length;S++){var b=u[S];if(b.include)throw new Error("Inheritance is not allowed in stateless lexers");if(b.error||b.fallback){if(y)throw!b.fallback==!y.fallback?new Error("Multiple "+(b.fallback?"fallback":"error")+" rules not allowed (for token '"+b.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+b.defaultType+"')");y=b}var I=b.match.slice();if(w)for(;I.length&&typeof I[0]=="string"&&I[0].length===1;){var ce=I.shift();m[ce.charCodeAt(0)]=b}if(b.pop||b.push||b.next){if(!p)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+b.defaultType+"')");if(b.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+b.defaultType+"')")}if(I.length!==0){w=!1,_.push(b);for(var F=0;F<I.length;F++){var te=I[F];if(o(te)){if(v===null)v=te.unicode;else if(v!==te.unicode&&b.fallback===!1)throw new Error("If one rule is /u then all must be")}}var le=f(I.map(h)),D=new RegExp(le);if(D.test(""))throw new Error("RegExp matches empty string: "+D);var ve=c(le);if(ve>0)throw new Error("RegExp has capture groups: "+D+`
Use (?: â€¦ ) instead`);if(!b.lineBreaks&&D.test(`
`))throw new Error("Rule should declare lineBreaks: "+D);R.push(l(le))}}var pe=y&&y.fallback,xe=r&&!pe?"ym":"gm",Me=r||pe?"":"|";v===!0&&(xe+="u");var En=new RegExp(f(R)+Me,xe);return{regexp:En,groups:_,fast:m,error:y||z}}function k(u){var p=P(j(u));return new C({start:p},"start")}function Te(u,p,y){var m=u&&(u.push||u.next);if(m&&!y[m])throw new Error("Missing state '"+m+"' (in token '"+u.defaultType+"' of state '"+p+"')");if(u&&u.pop&&+u.pop!=1)throw new Error("pop must be 1 (in token '"+u.defaultType+"' of state '"+p+"')")}function Xe(u,p){var y=u.$all?j(u.$all):[];delete u.$all;var m=Object.getOwnPropertyNames(u);p||(p=m[0]);for(var w=Object.create(null),v=0;v<m.length;v++){var _=m[v];w[_]=j(u[_]).concat(y)}for(var v=0;v<m.length;v++)for(var _=m[v],R=w[_],S=Object.create(null),b=0;b<R.length;b++){var I=R[b];if(I.include){var ce=[b,1];if(I.include!==_&&!S[I.include]){S[I.include]=!0;var F=w[I.include];if(!F)throw new Error("Cannot include nonexistent state '"+I.include+"' (in state '"+_+"')");for(var te=0;te<F.length;te++){var le=F[te];R.indexOf(le)===-1&&ce.push(le)}}R.splice.apply(R,ce),b--}}for(var D=Object.create(null),v=0;v<m.length;v++){var _=m[v];D[_]=P(w[_],!0)}for(var v=0;v<m.length;v++){for(var ve=m[v],pe=D[ve],xe=pe.groups,b=0;b<xe.length;b++)Te(xe[b],ve,D);for(var Me=Object.getOwnPropertyNames(pe.fast),b=0;b<Me.length;b++)Te(pe.fast[Me[b]],ve,D)}return new C(D,p)}function Ye(u){for(var p=typeof Map<"u",y=p?new Map:Object.create(null),m=Object.getOwnPropertyNames(u),w=0;w<m.length;w++){var v=m[w],_=u[v],R=Array.isArray(_)?_:[_];R.forEach(function(S){if(typeof S!="string")throw new Error("keyword must be string (in keyword '"+v+"')");p?y.set(S,v):y[S]=v})}return function(S){return p?y.get(S):y[S]}}var C=function(u,p){this.startState=p,this.states=u,this.buffer="",this.stack=[],this.reset()};C.prototype.reset=function(u,p){return this.buffer=u||"",this.index=0,this.line=p?p.line:1,this.col=p?p.col:1,this.queuedToken=p?p.queuedToken:null,this.queuedText=p?p.queuedText:"",this.queuedThrow=p?p.queuedThrow:null,this.setState(p?p.state:this.startState),this.stack=p&&p.stack?p.stack.slice():[],this},C.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedText:this.queuedText,queuedThrow:this.queuedThrow}},C.prototype.setState=function(u){if(!(!u||this.state===u)){this.state=u;var p=this.states[u];this.groups=p.groups,this.error=p.error,this.re=p.regexp,this.fast=p.fast}},C.prototype.popState=function(){this.setState(this.stack.pop())},C.prototype.pushState=function(u){this.stack.push(this.state),this.setState(u)};var Je=r?function(u,p){return u.exec(p)}:function(u,p){var y=u.exec(p);return y[0].length===0?null:y};C.prototype._getGroup=function(u){for(var p=this.groups.length,y=0;y<p;y++)if(u[y+1]!==void 0)return this.groups[y];throw new Error("Cannot find token type for matched text")};function Qe(){return this.value}if(C.prototype.next=function(){var u=this.index;if(this.queuedGroup){var p=this._token(this.queuedGroup,this.queuedText,u);return this.queuedGroup=null,this.queuedText="",p}var y=this.buffer;if(u!==y.length){var _=this.fast[y.charCodeAt(u)];if(_)return this._token(_,y.charAt(u),u);var m=this.re;m.lastIndex=u;var w=Je(m,y),v=this.error;if(w==null)return this._token(v,y.slice(u,y.length),u);var _=this._getGroup(w),R=w[0];return v.fallback&&w.index!==u?(this.queuedGroup=_,this.queuedText=R,this._token(v,y.slice(u,w.index),u)):this._token(_,R,u)}},C.prototype._token=function(u,p,y){var m=0;if(u.lineBreaks){var w=/\n/g,v=1;if(p===`
`)m=1;else for(;w.exec(p);)m++,v=w.lastIndex}var _={type:typeof u.type=="function"&&u.type(p)||u.defaultType,value:typeof u.value=="function"?u.value(p):p,text:p,toString:Qe,offset:y,lineBreaks:m,line:this.line,col:this.col},R=p.length;if(this.index+=R,this.line+=m,m!==0?this.col=R-v+1:this.col+=R,u.shouldThrow){var S=new Error(this.formatError(_,"invalid syntax"));throw S}return u.pop?this.popState():u.push?this.pushState(u.push):u.next&&this.setState(u.next),_},typeof Symbol<"u"&&Symbol.iterator){var Ke=function(u){this.lexer=u};Ke.prototype.next=function(){var u=this.lexer.next();return{value:u,done:!u}},Ke.prototype[Symbol.iterator]=function(){return this},C.prototype[Symbol.iterator]=function(){return new Ke(this)}}return C.prototype.formatError=function(m,p){if(m==null)var y=this.buffer.slice(this.index),m={text:y,offset:this.index,lineBreaks:y.indexOf(`
`)===-1?0:1,line:this.line,col:this.col};var w=2,v=Math.max(m.line-w,1),_=m.line+w,R=String(_).length,S=g(this.buffer,this.line-m.line+w+1).slice(0,5),b=[];b.push(p+" at line "+m.line+" col "+m.col+":"),b.push("");for(var I=0;I<S.length;I++){var ce=S[I],F=v+I;b.push(d(String(F),R)+"  "+ce),F===m.line&&b.push(d("",R+m.col+1)+"^")}return b.join(`
`)},C.prototype.clone=function(){return new C(this.states,this.state)},C.prototype.has=function(u){return!0},{compile:k,states:Xe,error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:Ye}})})(zn);const jt=rt,be="T_CODE",O="G_CODE",J="M_CODE",U="D_CODE",N="ASTERISK",G="PERCENT",zt="EQUALS",he="COMMA",oe="OPERATOR",ot="GERBER_FORMAT",Ae="GERBER_UNITS",Gt="GERBER_TOOL_MACRO",Lt="GERBER_TOOL_DEF",Dt="GERBER_LOAD_POLARITY",qt="GERBER_STEP_REPEAT",_e="GERBER_MACRO_VARIABLE",Ft="SEMICOLON",Bt="DRILL_UNITS",st="DRILL_ZERO_INCLUSION",A="COORD_CHAR",$="NUMBER",Gn="WORD",Ln="WHITESPACE",W="NEWLINE",Dn="CATCHALL",qn="ERROR",Fn=/^0*/,Ht=e=>e.replace(Fn,""),Se=e=>{const t=Ht(e.slice(1));return t===""?"0":t},Bn={[be]:{match:/T\d+/,value:Se},[O]:{match:/G\d+/,value:Se},[J]:{match:/M\d+/,value:Se},[U]:{match:/D\d+/,value:Se},[N]:"*",[G]:"%",[zt]:"=",[ot]:{match:/FS[ADILT]+/,value:e=>e.slice(2)},[Ae]:{match:/MO(?:IN|MM)/,value:e=>e.slice(2)},[Gt]:{match:/AM[$.A-Z_a-z][\w.-]*/,value:e=>e.slice(2)},[Lt]:{match:/ADD\d+[$.A-Z_a-z][\w.-]*/,value:e=>Ht(e.slice(3))},[Dt]:{match:/LP[CD]/,value:e=>e.slice(2)},[qt]:"SR",[_e]:/\$\d+/,[Ft]:";",[Bt]:/^(?:METRIC|INCH)/,[st]:{match:/,(?:TZ|LZ)/,value:e=>e.slice(1)},[A]:/[A-CFH-JNSX-Z]/,[$]:/[+-]?[\d.]+/,[oe]:["x","/","+","-","(",")"],[he]:",",[Gn]:/[A-Za-z]+/,[Ln]:/[\t ]+/,[W]:{match:/\r?\n/,lineBreaks:!0},[Dn]:/\S/,[qn]:jt.error};function Hn(){const e=jt.compile(Bn);return{feed:t};function t(r,o){return e.reset(r,o),n((o==null?void 0:o.offset)??0)}function n(r){return{[Symbol.iterator](){return this},next(){const o=e.next();if(o!==void 0){const s={...o,offset:r+o.offset},i={...e.save(),offset:r+(e.index??0)};return{value:[s,i]}}return{value:void 0,done:!0}}}}}const Ut="gerber",De="drill",ht="mm",qe="in",we="leading",Oe="trailing",Un="absolute",Vn="incremental",Fe="circle",dt="rectangle",it="obround",Vt="polygon",Wt="macroShape",Wn="1",Zn="2",Xn="20",Yn="21",Jn="22",Qn="4",Kn="5",er="6",tr="7",Y="shape",se="move",Ee="segment",Zt="slot",Xt="line",yt="cwArc",mt="ccwArc",Yt="single",nr="multi",Jt="dark",rr="clear",Be="TOKEN",ye="MIN_TO_MAX";function a(e,t){return{rule:Be,type:e,value:t}}function ie(e,t){return{rule:Be,type:e,value:t,negate:!0}}function ee(e){return{rule:ye,min:1,max:1,match:e}}function de(e){return{rule:ye,min:0,max:1,match:e}}function Z(e){return{rule:ye,min:0,max:Number.POSITIVE_INFINITY,match:e}}function Qt(e){return{rule:ye,min:1,max:Number.POSITIVE_INFINITY,match:e}}function ae(e,t,n){return{rule:ye,min:e,max:t,match:n}}function Kt(e,t){const n=[];for(const r of t){const o=sr(e,r.rules);if(o===tn)n.push(r);else if(o===en)return{filetype:r.filetype,nodes:r.createNodes(e)}}return n.length>0?{candidates:n,tokens:e}:{}}const en="FULL_MATCH",tn="PARTIAL_MATCH",or="NO_MATCH";function sr(e,t){let n=0,r=0,o=0;for(;n<t.length&&r<e.length;){const s=t[n],i=e[r];if(nn(s,i))s.rule===Be||o>=s.max-1?(n++,r++,o=0):(r++,o++);else if(s.rule===ye&&o>=s.min)o=0,n++;else return or}return n<t.length?tn:en}function nn(e,t){if(e.rule===Be){const n=e.type===t.type,r=e.value===null||e.value===void 0||typeof e.value=="string"&&e.value===t.value||e.value instanceof RegExp&&e.value.test(t.value),o=n&&r;return e.negate===!0?!o:o}return Array.isArray(e.match)?e.match.some(n=>nn(n,t)):!1}const ir="root",gt="comment",ar="drillHeader",vt="done",He="units",xt="coordinateFormat",$e="toolDefinition",rn="toolMacro",Ue="toolChange",at="loadPolarity",ur="stepRepeat",Q="graphic",me="interpolateMode",ut="regionMode",on="quadrantMode",cr="unimplemented",lr="macroComment",sn="macroVariable",an="macroPrimitive";function ue(e){return Object.fromEntries(e.map((t,n)=>[t,n>0?e[n-1]:void 0]).filter(t=>{const[n,r]=t;return n.type===$&&(r==null?void 0:r.type)===A}).map(([t,n])=>[n.value.toLowerCase(),t.value]))}function Ve(e){const t=e.filter(n=>n.type===O).map(n=>n.value==="0"?se:n.value==="1"?Xt:n.value==="2"?yt:n.value==="3"?mt:n.value==="5"?De:!1);return typeof t[0]=="string"?t[0]:void 0}function pr(e){const t=e.filter(n=>n.type===U).map(n=>n.value==="1"?Ee:n.value==="2"?se:n.value==="3"?Y:!1);return typeof t[0]=="string"?t[0]:void 0}function bt(e){return e.map(t=>t.value).join("").trim()}function T(e,t={}){const{head:n=e[0],length:r=0}=t,o=r>0?e[e.indexOf(n)+r-1]:e[e.length-1];return{start:{line:n.line,column:n.col,offset:n.offset},end:{line:o.line,column:o.col,offset:o.offset}}}const fr={name:"units",rules:[ee([a(Bt),a(J,"71"),a(J,"72")]),Z([a(he),a(st),a($,/^0{1,8}\.0{1,8}$/)]),a(W)],createNodes(e){const t=e[0].value==="INCH"||e[0].value==="72"?qe:ht,n=e.filter(s=>s.type===st).map(s=>s.value==="LZ"?Oe:we),r=e.filter(s=>s.type===$).map(s=>{const[i="",c=""]=s.value.split(".");return[i.length,c.length]}),o=[{type:He,position:T(e.slice(0,2)),units:t}];return(n.length>0||r.length>0)&&o.push({type:xt,position:T(e.slice(1)),mode:void 0,format:r[0],zeroSuppression:n[0]}),o}},hr={name:"tool",rules:[a(be),ae(0,12,[a(A,"C"),a(A,"F"),a(A,"S"),a(A,"B"),a(A,"H"),a(A,"Z"),a($)]),a(W)],createNodes(e){const t=e[0].value,n=T(e),{c:r}=ue(e.slice(1,-1));return r===void 0?[{type:Ue,position:n,code:t}]:[{type:$e,shape:{type:Fe,diameter:Number(r)},hole:void 0,position:n,code:t}]}},dr={name:"operationMode",rules:[ee([a(O,"0"),a(O,"1"),a(O,"2"),a(O,"3"),a(O,"5")]),a(W)],createNodes:e=>[{type:me,position:T(e),mode:Ve(e)}]},yr={name:"operation",rules:[ae(0,2,[a(be),a(O,"0"),a(O,"1"),a(O,"2"),a(O,"3"),a(O,"5")]),ae(2,8,[a(A),a($)]),de([a(be)]),a(W)],createNodes(e){const t=e.filter(d=>d.type===A||d.type===$),n=e.find(d=>d.type===O),r=e.find(d=>d.type===be),o=ue(t),s=r==null?void 0:r.value,i=Ve(e),c=T(e,{head:t[0],length:t.length+1}),l=T(e,{head:n,length:2}),f=T(e,{head:r,length:2}),h=[{type:Q,position:c,graphic:void 0,coordinates:o}];return i!==void 0&&h.unshift({type:me,position:l,mode:i}),s!==void 0&&h.unshift({type:Ue,position:f,code:s}),h}},mr={name:"slot",rules:[ae(2,4,[a(A),a($)]),a(O,"85"),ae(2,4,[a(A),a($)]),a(W)],createNodes(e){const t=e.find(s=>s.type===O),n=t===void 0?-1:e.indexOf(t),r=Object.fromEntries(Object.entries(ue(e.slice(0,n))).map(([s,i])=>[`${s}0`,i])),o=ue(e.slice(n));return[{type:Q,position:T(e),graphic:Zt,coordinates:{...r,...o}}]}},gr={name:"done",rules:[ee([a(J,"30"),a(J,"0")]),a(W)],createNodes:e=>[{type:vt,position:T(e)}]},vr={name:"header",rules:[ee([a(J,"48"),a(G)]),a(W)],createNodes:e=>[{type:ar,position:T(e)}]},xr={name:"comment",rules:[a(Ft),Z([ie(W)]),a(W)],createNodes:e=>[{type:gt,comment:bt(e.slice(1,-1)),position:T(e)}]},un=[hr,dr,yr,mr,xr,fr,gr,vr].map(e=>({...e,filetype:De})),br={name:"macroComment",rules:[a($,"0"),Z([ie(N)]),a(N)],createNodes:_r},wr={name:"macroVariable",rules:[a(_e),a(zt),Qt([a($),a(oe),a(_e),a(A,"X")]),a(N)],createNodes:Tr},Er={name:"macroPrimitive",rules:[a($),a(he),Qt([a(he),a($),a(oe),a(_e),a(A,"X")]),a(N)],createNodes:Or};function _r(e){const t=e.slice(1,-1).map(n=>n.text).join("").trim();return[{type:lr,position:T(e),comment:t}]}function Or(e){const t=e[0].value,n=[[]];let r=n[0];for(const s of e.slice(2,-1))s.type===he?(r=[],n.push(r)):r.push(s);const o=n.map(s=>cn(s));return[{type:an,position:T(e),code:t,parameters:o}]}function Tr(e){const t=e[0].value,n=cn(e.slice(2,-1));return[{type:sn,position:T(e),name:t,value:n}]}function cn(e){const t=e.map(i=>i.type===A?Object.assign(i,{type:oe,value:"x"}):i);return s();function n(){return t[0]}function r(){const i=t.shift();if((i==null?void 0:i.type)===$)return Number(i.value);if((i==null?void 0:i.type)===_e)return i.value;const c=s();return t.shift(),c}function o(){let i=r(),c=n();for(;(c==null?void 0:c.type)===oe&&(c.value==="x"||c.value==="/");)t.shift(),i={left:i,right:r(),operator:c.value},c=n();return i}function s(){let i=o(),c=n();for(;(c==null?void 0:c.type)===oe&&(c.value==="+"||c.value==="-")||(c==null?void 0:c.type)===$;){let l="+";c.type===oe&&(t.shift(),l=c.value);const f=o();i={left:i,right:f,operator:l},c=n()}return i}}const Ot=[Er,wr,br];function Mr(e){let t=Ot,n=[];const r=[];for(const o of e){n.push(o);const s=Kt(n,t);s.nodes!==void 0&&r.push(...s.nodes),n=s.tokens??[],t=s.candidates??Ot}return r}const tt=e=>{if(e.length===1){const[t]=e;return{type:Fe,diameter:t}}if(e.length===2){const[t,n]=e;return{type:dt,xSize:t,ySize:n}}},kr={name:"done",rules:[ee([a(J,"0"),a(J,"2")]),a(N)],createNodes:e=>[{type:vt,position:T(e)}]},Sr={name:"comment",rules:[a(O,"4"),Z([ie(N)]),a(N)],createNodes:e=>[{type:gt,position:T(e),comment:bt(e.slice(1,-1))}]},Nr={name:"format",rules:[a(G),a(ot),Z([ie(A,"X")]),a(A,"X"),a($),a(A,"Y"),a($),Z([ie(N)]),a(N),ae(0,2,[a(Ae),a(N)]),a(G)],createNodes(e){var t;let n,r,o;const s=ue(e),i=e.findIndex(f=>f.type===N),c=e.find(f=>f.type===Ae);for(const f of e.filter(h=>h.type===ot))f.value.includes("T")&&(r=Oe),f.value.includes("L")&&(r=we),f.value.includes("I")&&(o=Vn),f.value.includes("A")&&(o=Un);if(s.x===s.y&&((t=s.x)==null?void 0:t.length)===2){const f=Number(s.x[0]),h=Number(s.x[1]);f>0&&h>0&&(n=[f,h])}const l=[{type:xt,position:T(e.slice(1,i+1)),zeroSuppression:r,format:n,mode:o}];return c!==void 0&&l.push({type:He,position:T(e.slice(1,-1),{head:c}),units:c.value==="MM"?ht:qe}),l}},Rr={name:"units",rules:[a(G),a(Ae),a(N),a(G)],createNodes:e=>[{type:He,position:T(e.slice(1,-1)),units:e[1].value==="MM"?ht:qe}]},Pr={name:"toolMacro",rules:[a(G),a(Gt),a(N),Z([ie(G)]),a(G)],createNodes(e){const t=e[1].value,n=T(e.slice(1,-1)),r=e.slice(3,-1);return[{type:rn,position:n,children:Mr(r),name:t}]}},Cr={name:"toolDefinition",rules:[a(G),a(Lt),Z([a(he),a($),a(A,"X")]),a(N),a(G)],createNodes(e){let t,n;const r=/(\d+)(.+)/.exec(e[1].value),[,o="",s=""]=r??[],i=e.slice(3,-2).filter(c=>c.type===$).map(c=>Number(c.value));switch(s){case"C":{const[c,...l]=i;t={type:Fe,diameter:c},n=tt(l);break}case"R":case"O":{const[c,l,...f]=i;t={type:s==="R"?dt:it,xSize:c,ySize:l},n=tt(f);break}case"P":{const[c,l,f,...h]=i;t={type:Vt,diameter:c,vertices:l,rotation:f},n=tt(h);break}default:t={type:Wt,name:s,variableValues:i}}return[{type:$e,position:T(e.slice(1,-1)),code:o,shape:t,hole:n}]}},Ar={name:"toolChange",rules:[de([a(O,"54")]),a(U),a(N)],createNodes:e=>e.filter(({type:t})=>t===U).map(({value:t})=>({type:Ue,position:T(e),code:t}))},ln=e=>{const t=pr(e),n=ue(e),r=Ve(e),o=T(e,{head:r===void 0?e[0]:e[1]}),s=[{type:Q,position:o,graphic:t,coordinates:n}];if(r!==void 0){const i=T(e,{head:e[0],length:2});s.unshift({type:me,position:i,mode:r})}return s},$r={name:"operation",rules:[de([a(O,"1"),a(O,"2"),a(O,"3")]),ae(2,8,[a(A),a($)]),de([a(U,"1"),a(U,"2"),a(U,"3")]),a(N)],createNodes:ln},Ir={name:"operationWithoutCoords",rules:[de([a(O,"1"),a(O,"2"),a(O,"3")]),de([a(U,"1"),a(U,"2"),a(U,"3")]),a(N)],createNodes:ln},jr={name:"interpolationMode",rules:[ee([a(O,"1"),a(O,"2"),a(O,"3")]),a(N)],createNodes:e=>[{type:me,position:T(e),mode:Ve(e)}]},zr={name:"regionMode",rules:[ee([a(O,"36"),a(O,"37")]),a(N)],createNodes:e=>[{type:ut,position:T(e),region:e[0].value==="36"}]},Gr={name:"quadrantMode",rules:[ee([a(O,"74"),a(O,"75")]),a(N)],createNodes:e=>[{type:on,position:T(e),quadrant:e[0].value==="74"?Yt:nr}]},Lr={name:"loadPolarity",rules:[a(G),a(Dt),a(N),a(G)],createNodes:e=>[{type:at,position:T(e.slice(1,-1)),polarity:e[1].value==="D"?Jt:rr}]},Dr={name:"stepRepeat",rules:[a(G),a(qt),Z([a(A),a($)]),a(N),a(G)],createNodes(e){const t=ue(e),n=Object.fromEntries(Object.entries(t).map(([r,o])=>[r,Number(o)]));return[{type:ur,position:T(e.slice(1,-1)),stepRepeat:n}]}},qr={name:"unimplementedExtendedCommand",rules:[a(G),Z([ie(N)]),a(N),a(G)],createNodes:e=>[{type:cr,position:T(e.slice(1,-1)),value:bt(e)}]},pn=[$r,Ir,jr,Ar,Cr,Pr,Sr,zr,Gr,Lr,Dr,Nr,Rr,kr,qr].map(e=>({...e,filetype:Ut})),Fr=[...pn,...un];function Br(e,t){const n=[];let r=c(),o=[],s,i="";for(const[l,f]of e){o.push(l);const h=Kt(o,r);h.nodes===void 0?i+=l.text:(n.push(...h.nodes),s=f,i=""),t=t??h.filetype,o=h.tokens??[],r=h.candidates??c()}return{filetype:t,unmatched:i,nodes:n,lexerState:s};function c(){return t===Ut?pn:t===De?un:Fr}}function Hr(){const e=Hn(),t=[];let n,r,o="";const s={lexer:e,feed:i,result:c};return s;function i(l){l=l.replace(new RegExp("(?<!\\*|%|\\r|\\n)(?:\\r|\\n|\\r\\n)(?!\\r|\\n)","gm"),"");const f=e.feed(`${o}${l}`,r),h=Br(f,n);n=n??h.filetype,o=h.unmatched,r=h.lexerState??r;for(const d of h.nodes)t.push(d);return s}function c(){if(n===void 0)throw new Error("File type not recognized");return{type:ir,filetype:n,children:t}}}function Ur(e){return Hr().feed(e).result()}const Vr="image",Ie="imageShape",fn="imagePath",Wr="imageRegion",L="line",B="arc",ge="circle",We="rectangle",q="polygon",Ze="outline",wt="layeredShape",{PI:K}=Math,X=K/2,hn=3*X,H=2*K;function ct(e){return e>=0&&e<=H?e:e<0?e+H:e>H?e-H:ct(e)}function Tt(e){return e>=X?e-X:e+hn}function dn(e){return e*K/180}function V(e,t,n=0){const r=dn(n),[o,s]=[Math.sin(r),Math.cos(r)],[i,c]=e,l=i*s-c*o+t[0],f=i*o+c*s+t[1];return[l,f]}function yn(e,t){return e[0]===t[0]&&e[1]===t[1]}function Mt(e){return e.length===0}function Zr(){return[]}function Xr(e,t){return Mt(e)?t:Mt(t)?e:[Math.min(e[0],t[0]),Math.min(e[1],t[1]),Math.max(e[2],t[2]),Math.max(e[3],t[3])]}function je(e){return e.reduce(Xr,Zr())}function Yr(e){return je(e.map(Jr))}function Jr(e){return e.type===Ie?mn(e.shape):gn(e.segments,e.type===fn?e.width:void 0)}function mn(e){switch(e.type){case ge:{const{cx:t,cy:n,r}=e;return lt([t,n],r)}case We:{const{x:t,y:n,xSize:r,ySize:o}=e;return[t,n,t+r,n+o]}case q:return je(e.points.map(t=>lt(t)));case Ze:return gn(e.segments);case wt:return je(e.shapes.filter(({erase:t})=>t!==!0).map(mn))}}function gn(e,t=0){const n=t/2,r=[];for(const o of e)if(r.push(o.start,o.end),o.type===B){const{start:s,end:i,center:c,radius:l}=o,f=Math.abs(i[2]-s[2]);let[h,d]=i[2]>s[2]?[s[2],i[2]]:[i[2],s[2]];h=ct(h),d=ct(d);const g=[[c[0]+l,c[1]],[c[0],c[1]+l],[c[0]-l,c[1]],[c[0],c[1]-l]];for(const x of g)(h>d||f===H)&&r.push(x),h=Tt(h),d=Tt(d)}return je(r.map(o=>lt(o,n)))}function lt(e,t=0){return[e[0]-t,e[1]-t,e[0]+t,e[1]+t]}const Qr=/FORMAT={?(\d):(\d)/;function Kr(e){const{children:t}=e;let n,r,o,s=0;for(;s<t.length&&(n===void 0||r===void 0||o===void 0);){const i=t[s];switch(i.type){case He:{n=i.units;break}case xt:{r=i.format??void 0,o=i.zeroSuppression??void 0;break}case Q:{const{coordinates:c}=i;for(const l of Object.values(c)){if(o!==void 0)break;(l==null?void 0:l.endsWith("0"))===!0||(l==null?void 0:l.includes("."))===!0?o=we:(l==null?void 0:l.startsWith("0"))===!0&&(o=Oe)}break}case gt:{const{comment:c}=i,l=Qr.exec(c);/suppress trailing/i.test(c)?o=Oe:/(suppress leading|keep zeros)/i.test(c)&&(o=we),l!==null&&(r=[Number(l[1]),Number(l[2])]);break}}s+=1}return{units:n??qe,coordinateFormat:r??[2,4],zeroSuppression:o??we}}const ze="simpleTool",vn="macroTool";function eo(){return Object.create(to)}const to={_currentToolCode:void 0,_toolsByCode:{},_macrosByName:{},use(e){if(e.type===rn&&(this._macrosByName[e.name]=e.children),e.type===$e){const{code:t,shape:n,hole:r}=e,o=n.type===Wt?{type:vn,macro:this._macrosByName[n.name]??[],variableValues:n.variableValues}:{type:ze,shape:n,hole:r??void 0};this._toolsByCode[t]=o}return(e.type===$e||e.type===Ue)&&(this._currentToolCode=e.code),typeof this._currentToolCode=="string"?this._toolsByCode[this._currentToolCode]:void 0}};function no(){return Object.create(ro)}const ro={_DEFAULT_ARC_OFFSETS:{i:0,j:0,a:0},_previousPoint:{x:0,y:0},use(e,t){let n=this._DEFAULT_ARC_OFFSETS,r=this._previousPoint,o=r;if(e.type===Q){const{coordinates:s}=e,i=ne(s.x0,r.x,t),c=ne(s.y0,r.y,t),l=ne(s.x,i,t),f=ne(s.y,c,t),h=ne(s.i,0,t),d=ne(s.j,0,t),g=ne(s.a,0,t);(r.x!==i||r.y!==c)&&(r={x:i,y:c}),(o.x!==l||o.y!==f)&&(o={x:l,y:f}),(h!==0||d!==0||g!==0)&&(n={i:h,j:d,a:g})}return this._previousPoint=o,{startPoint:r,endPoint:o,arcOffsets:n}}};function ne(e,t,n){if(typeof e!="string")return t;if(e.includes(".")||e==="0")return Number(e);const{coordinateFormat:r,zeroSuppression:o}=n,[s,i]=r,[c,l]=e.startsWith("+")||e.startsWith("-")?[e[0],e.slice(1)]:["+",e],f=s+i,h=o===Oe?l.padEnd(f,"0"):l.padStart(f,"0"),d=h.slice(0,s),g=h.slice(s);return+`${c}${d}.${g}`}function kt(e,t){const{x:n,y:r}=t;switch(e.type){case Fe:{const{diameter:o}=e;return{type:ge,cx:n,cy:r,r:o/2}}case dt:case it:{const{xSize:o,ySize:s}=e,i=o/2,c=s/2,l={type:We,x:n-i,y:r-c,xSize:o,ySize:s};return e.type===it&&(l.r=Math.min(i,c)),l}case Vt:{const{diameter:o,rotation:s,vertices:i}=e,c=o/2,l=dn(s??0),f=H/i,h=Array.from({length:i}).map((d,g)=>{const x=f*g+l,E=n+c*Math.cos(x),M=r+c*Math.sin(x);return[E,M]});return{type:q,points:h}}}}function pt(e){if(e.type===ge){const{cx:t,cy:n,r}=e;return[{type:B,start:[t+r,n,0],end:[t+r,n,H],center:[t,n],radius:r}]}if(e.type===We){const{x:t,y:n,xSize:r,ySize:o,r:s}=e;return s===r/2?[{type:L,start:[t+r,n+s],end:[t+r,n+o-s]},{type:B,start:[t+r,n+o-s,0],end:[t,n+o-s,K],center:[t+s,n+o-s],radius:s},{type:L,start:[t,n+o-s],end:[t,n+s]},{type:B,start:[t,n+s,K],end:[t+r,n+s,H],center:[t+s,n+s],radius:s}]:s===o/2?[{type:L,start:[t+s,n],end:[t+r-s,n]},{type:B,start:[t+r-s,n,-X],end:[t+r-s,n+o,X],center:[t+r-s,n+s],radius:s},{type:L,start:[t+r-s,n+o],end:[t+s,n+o]},{type:B,start:[t+s,n+o,X],end:[t+s,n,hn],center:[t+s,n+s],radius:s}]:[{type:L,start:[t,n],end:[t+r,n]},{type:L,start:[t+r,n],end:[t+r,n+o]},{type:L,start:[t+r,n+o],end:[t,n+o]},{type:L,start:[t,n+o],end:[t,n]}]}return e.type===q?e.points.map((t,n)=>{const r=n<e.points.length-1?n+1:0;return{type:L,start:t,end:e.points[r]}}):e.segments}function oo(e,t){const{shape:n,hole:r}=e,o=kt(n,t.endPoint);if(r!==void 0){const s=kt(r,t.endPoint);return{type:Ze,segments:[...pt(o),...pt(s)]}}return o}function so(e,t){const n=e.filter(r=>r.type===L).map(r=>io(r,t));return{type:Ie,shape:{type:wt,shapes:n}}}function io(e,t){const{start:n,end:r}=e,[o,s]=n,[i,c]=r,[l,f]=[t.xSize/2,t.ySize/2],h=Math.atan2(c-s,i-c),[d,g]=[o-l,o+l],[x,E]=[s-f,s+f],[M,j]=[i-l,i+l],[z,P]=[c-f,c+f];let k=[];return yn(n,r)?k=[[d,x],[g,x],[j,z],[j,P],[M,P],[d,E]]:h>=0&&h<X?k=[[d,x],[g,x],[j,z],[j,P],[M,P],[d,E]]:h>=X&&h<=K?k=[[g,x],[g,E],[j,P],[M,P],[M,z],[d,x]]:h>=-K&&h<-X?k=[[g,E],[d,E],[M,P],[M,z],[j,z],[g,x]]:k=[[d,E],[d,x],[M,z],[j,z],[j,P],[g,E]],{type:q,points:k}}const xn="cw",Et="ccw";function St(e,t,n){return t===void 0?bn(e):ao(e,t,n)}function Nt(e,t,n=!1){if(e.length>0){if(n)return{type:Wr,segments:e};if((t==null?void 0:t.type)===ze&&t.shape.type===ge)return{type:fn,width:t.shape.diameter,segments:e};if((t==null?void 0:t.type)===ze&&t.shape.type===We)return so(e,t.shape)}}function bn(e){return{type:L,start:[e.startPoint.x,e.startPoint.y],end:[e.endPoint.x,e.endPoint.y]}}function ao(e,t,n=!1){const{startPoint:r,endPoint:o,arcOffsets:s}=e,i=s.a>0?s.a:(s.i**2+s.j**2)**.5;if(n||s.a>0){if(r.x===o.x&&r.y===o.y)return bn(e);const[d,g,x]=uo(e,i).map(E=>Ge(r,o,E,t)).sort(([E,M],[j,z])=>{const P=Math.abs(M[2]-E[2]),k=Math.abs(z[2]-j[2]);return P-k})[0];return{type:B,start:d,end:g,center:x,radius:i}}const c={x:r.x+s.i,y:r.y+s.j},[l,f,h]=Ge(r,o,c,t);return{type:B,start:l,end:f,center:h,radius:i}}function Ge(e,t,n,r){let o=Math.atan2(e.y-n.y,e.x-n.x),s=Math.atan2(t.y-n.y,t.x-n.x);return r===Et?s=s>o?s:s+H:o=o>s?o:o+H,[[e.x,e.y,o],[t.x,t.y,s],[n.x,n.y]]}function uo(e,t){const{x:n,y:r}=e.startPoint,{x:o,y:s}=e.endPoint,[i,c]=[o-n,s-r],[l,f]=[o+n,s+r],h=Math.sqrt(i**2+c**2);if(t<=h/2)return[{x:n+i/2,y:r+c/2}];const d=Math.sqrt(4*t**2/h**2-1),[g,x]=[l/2,f/2],[E,M]=[c*d/2,i*d/2];return[{x:g+E,y:x-M},{x:g-E,y:x+M}]}function co(e,t){const n=[],r=Object.fromEntries(e.variableValues.map((o,s)=>[`$${s+1}`,o]));for(const o of e.macro)if(o.type===sn&&(r[o.name]=Le(o.value,r)),o.type===an){const s=[t.endPoint.x,t.endPoint.y],i=o.parameters.map(c=>Le(c,r));n.push(...lo(o.code,s,i))}return{type:wt,shapes:n}}function Le(e,t){if(typeof e=="number")return e;if(typeof e=="string")return t[e];const n=Le(e.left,t),r=Le(e.right,t);switch(e.operator){case"+":return n+r;case"-":return n-r;case"x":return n*r;case"/":return n/r}}function lo(e,t,n){switch(e){case Wn:return[po(t,n)];case Xn:case Zn:return[fo(t,n)];case Yn:return[ho(t,n)];case Jn:return[yo(t,n)];case Qn:return[mo(t,n)];case Kn:return[go(t,n)];case er:return vo(t,n);case tr:return[xo(t,n)]}return[]}function po(e,t){const[n,r,o,s,i]=t,c=r/2,[l,f]=V([o,s],e,i);return{type:ge,erase:n===0,cx:l,cy:f,r:c}}function fo(e,t){const[n,r,o,s,i,c,l]=t,[f,h]=[c-s,i-o],d=r/2,g=Math.sqrt(f**2+h**2),[x,E]=[-(d*f)/g,d*h/g];return{type:q,erase:n===0,points:[[o+x,s-E],[i+x,c-E],[i-x,c+E],[o-x,s+E]].map(M=>V(M,e,l))}}function ho(e,t){const[n,r,o,s,i,c]=t,[l,f]=[r/2,o/2];return{type:q,erase:n===0,points:[[s-l,i-f],[s+l,i-f],[s+l,i+f],[s-l,i+f]].map(h=>V(h,e,c))}}function yo(e,t){const[n,r,o,s,i,c]=t;return{type:q,erase:n===0,points:[[s,i],[s+r,i],[s+r,i+o],[s,i+o]].map(l=>V(l,e,c))}}function mo(e,t){const[n,,...r]=t.slice(0,-1),o=t[t.length-1];return{type:q,erase:n===0,points:r.flatMap((s,i)=>i%2===1?[[r[i-1],s]]:[]).map(s=>V(s,e,o))}}function go(e,t){const[n,r,o,s,i,c]=t,l=i/2,f=2*K/r,h=[];let d;for(d=0;d<r;d++){const g=f*d,x=o+l*Math.cos(g),E=s+l*Math.sin(g);h.push(V([x,E],e,c))}return{type:q,erase:n===0,points:h}}function vo(e,t){const n=P=>V(P,e,t[8]),[r,o,s,i,c,l,f,h]=t,[d,g]=n([r,o]),x=f/2,E=h/2,M=[];let j=0,z=s;for(;z>=0&&j<l;){const P=z/2,k=P-i;M.push(P),k>0&&M.push(k),j+=1,z=2*(k-c)}return[{type:Ze,segments:M.flatMap(P=>pt({type:ge,cx:d,cy:g,r:P}))},{type:q,points:[[r-x,o-E],[r+x,o-E],[r+x,o+E],[r-x,o+E]].map(n)},{type:q,points:[[r-E,o-x],[r+E,o-x],[r+E,o+x],[r-E,o+x]].map(n)}]}function xo(e,t){const[n,r,o,s,i,c]=t,l=V([n,r],e,c),[f,h]=[o/2,s/2],d=i/2,g=f**2-d**2,x=h**2-d**2,E=Math.sqrt(g),M=x>=0?Math.sqrt(x):d,j=[0,90,180,270],z=[];for(const P of j){const k=[[M,d],[E,d],[d,E],[d,M]].map(C=>V(C,[n,r],P)).map(C=>V(C,e,c)),[Te,Xe,Ye]=Ge({x:k[1][0],y:k[1][1]},{x:k[2][0],y:k[2][1]},{x:l[0],y:l[1]},Et);if(z.push({type:L,start:k[0],end:k[1]},{type:B,start:Te,end:Xe,center:Ye,radius:f},{type:L,start:k[2],end:k[3]}),!yn(k[0],k[3])){const[C,Je,Qe]=Ge({x:k[3][0],y:k[3][1]},{x:k[0][0],y:k[0][1]},{x:l[0],y:l[1]},xn);z.push({type:B,start:C,end:Je,center:Qe,radius:h})}}return{type:Ze,segments:z}}function bo(e){const t=Object.create(wo);return e===De?Object.assign(t,Eo):t}const wo={_currentPath:void 0,_arcDirection:void 0,_ambiguousArcCenter:!1,_regionMode:!1,_defaultGraphic:void 0,_polarity:Jt,plot(e,t,n){const r=[];let o;e.type!==Q?o=void 0:e.graphic!==void 0?o=e.graphic:this._defaultGraphic!==void 0&&(o=this._defaultGraphic);const s=this._plotCurrentPath(e,t,o);if(s!==void 0&&r.push({...s,polarity:this._polarity}),this._setGraphicState(e),o===Y&&(t==null?void 0:t.type)===ze&&r.push({type:Ie,shape:oo(t,n),polarity:this._polarity}),o===Y&&(t==null?void 0:t.type)===vn&&r.push({type:Ie,shape:co(t,n),polarity:this._polarity}),o===Ee&&(this._currentPath=this._currentPath??{segments:[],region:this._regionMode,tool:t},this._currentPath.segments.push(St(n,this._arcDirection,this._ambiguousArcCenter))),o===Zt){const i=Nt([St(n)],t);i!==void 0&&r.push({...i,polarity:this._polarity})}return r},_setGraphicState(e){e.type===me&&(this._arcDirection=wn(e.mode)),e.type===on&&(this._ambiguousArcCenter=e.quadrant===Yt),e.type===ut&&(this._regionMode=e.region),e.type===at&&(this._polarity=e.polarity),e.type===Q&&(e.graphic===Ee?this._defaultGraphic=Ee:e.graphic===se?this._defaultGraphic=se:e.graphic===Y&&(this._defaultGraphic=Y))},_plotCurrentPath(e,t,n){if(this._currentPath!==void 0&&(t!==this._currentPath.tool||e.type===ut||e.type===vt||n===se&&this._currentPath.region||n===Y||e.type===at)){const r=Nt(this._currentPath.segments,this._currentPath.tool,this._currentPath.region);return this._currentPath=void 0,r}}},Eo={_defaultGraphic:Y,_ambiguousArcCenter:!0,_setGraphicState(e){if(e.type===me){const{mode:t}=e;this._arcDirection=wn(t),t===yt||t===mt||t===Xt?this._defaultGraphic=Ee:t===se?this._defaultGraphic=se:this._defaultGraphic=Y}if(e.type===Q)return e.graphic??this._defaultGraphic}};function wn(e){if(e===mt)return Et;if(e===yt)return xn}function _o(e){const t=Kr(e),n=eo(),r=no(),o=bo(e.filetype),s=[];for(const i of e.children){const c=n.use(i),l=r.use(i,t),f=o.plot(i,c,l);s.push(...f)}return{type:Vr,units:t.units,size:Yr(s),children:s}}const Oo={parseGerber(e){const t=Ur(e);return _o(t)}};ft(Oo);
